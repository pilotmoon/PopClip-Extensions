#popclip
name: GitHub PR Approve
identifier: com.wangyimin.popclip.extension.github-approve
description: Approve a GitHub Pull Request using qkflow, with optional auto-merge.
popclipVersion: 4586
icon: ğŸ‘
regex: https://github\.com/[^/]+/[^/]+/pull/\d+
interpreter: zsh
shell script: |
  # æ·»åŠ  Go bin åˆ° PATH
  export PATH="$HOME/go/bin:$PATH"
  
  URL="$POPCLIP_TEXT"
  
  # æ„å»ºå‘½ä»¤
  CMD="qkflow pr approve \"$URL\""
  
  # å¦‚æœ autoMerge é€‰é¡¹ä¸º trueï¼Œæ·»åŠ  -m å‚æ•°
  if [[ "$POPCLIP_OPTION_AUTOMERGE" == "1" ]]; then
    CMD="$CMD -m"
  fi
  
  # æ‰§è¡Œå‘½ä»¤å¹¶æ•è·è¾“å‡º
  OUTPUT=$(eval $CMD 2>&1)
  EXIT_CODE=$?
  
  # è§£æè¾“å‡ºåˆ¤æ–­æˆåŠŸæˆ–å¤±è´¥
  if [[ $EXIT_CODE -eq 0 ]]; then
    if echo "$OUTPUT" | grep -q "âœ….*approved"; then
      echo "âœ… PR approved successfully!"
    elif echo "$OUTPUT" | grep -q "âŒ"; then
      # æå–é”™è¯¯ä¿¡æ¯
      ERROR=$(echo "$OUTPUT" | grep "âŒ" | tail -1)
      echo "$ERROR"
    else
      echo "âœ… Command completed"
    fi
  else
    echo "âŒ Failed to approve PR"
    echo "$OUTPUT"
  fi
after: show-result
options:
  - identifier: autoMerge
    label: Auto Merge
    type: boolean
    defaultValue: true
    description: "Add '-m' flag to trigger auto-merge when approving the PR."

